<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="@the_engi_nerd">
<meta name="dcterms.date" content="2024-02-16">

<title>the_engi_nerd - Testing of the F-35C Tailhook</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">the_engi_nerd</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/the-engi-nerd"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/the_engi_nerd"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Testing of the F-35C Tailhook</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">F35</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p><span class="citation" data-cites="the_engi_nerd">@the_engi_nerd</span> </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 16, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>Welcome to the blog. As a way to kick things off, here’s a single-page version of my thread on the F-35C tailhook.</p>
<p><img src="images/clipboard-270015806.png" class="img-fluid"></p>
<p>The primary source for material here, aside from my own experiences, is “F-35C Carrier Suitability Testing” by Tony “Brick” Wilson, who gives us one of the greatest flexes in an AIAA paper I’ve ever seen.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/clipboard-3796555614.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="800"></p>
</figure>
</div>
<p>The F-35C is the variant of the F-35 Joint Strike Fighter intended for use on CATOBAR (Catapult Assisted TakeOff, Barrier Assisted Recovery) aircraft carriers operated by the United States Navy. Aircraft are launched via steam or electromagnetic catapults, and on landing, the aircraft uses a tailhook to engage an arresting wire.</p>
<p>The F-35C hook is stowed in a bay that’s covered by clamshell doors during flight. The hook is electronically controlled and moved by hydraulics. And originally, it didn’t work.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/clipboard-2200776526.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="500"></p>
</figure>
</div>
<p>We began serious carrier suitability testing with F-35C at Lakehurst NAS in the summer of 2011. We would hold our briefings in the same hangar that the Hindenburg was trying to reach when it crashed. This is a level of irony that took zoomers another ten years to reach.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/clipboard-1904785528.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>After things like Jet Blast Deflector compatibility testing, we get down to testing the hook. Brick tells us, in a masterful understatement:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/clipboard-4221285650.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>I was at Lakehurst for most of this testing and I never saw the hook engage the wire. It was interesting to see it play out this way. I heard it predicted first, by, of all people, one of our instrumentation technicians on November 6, 2010 That was the day CF-01 arrived at Pax. We went to look at the jet. I remember standing with this tech, looking at the hook.</p>
<p>“Boss,” he says to me, “This fucker ain’t gonna work. Look at this thing. It’s short, it’s too close to the wheels, and look at this dumbass hook shoe they got on it. If the wire don’t hit it exactly right, it’s just gonna go under the hook and you’ll bolter.”</p>
<p>The hook point is only a little over 7 feet from the main landing gear axle center. The amount of space in the airframe available is extremely tight, so this is what the designers had to work with.</p>
<p>Here’s pretty much what we were looking at in this conversation. <img src="images/clipboard-4283089921.png" class="img-fluid"> Why was it like this?</p>
<p>Because the engineers at Northrop Grumman engineered to a computer model that can simulate how an arresting wire acts when used for arrestment, and the model was wrong.</p>
<p>I heard years later in the course of my job verifying and validating other F-35 simulations that the wire dynamics model supplied by the Navy had not been properly V&amp;V’d.&nbsp;I don’t know this for sure. However it happened, the model led to a design that didn’t work.</p>
<p>To understand <em>how</em> it didn’t work, back to Brick’s article. When an aircraft performing an arrestment lands, its main and/or nose tires hit the wire first. This starts a wave in the wire that moves away from the tire. Here’s an example, the nose gear has just hit the wire.</p>
<p><img src="images/clipboard-2195312844.png" class="img-fluid"></p>
<p>Now the aircraft continues to move forward. We have a wave propagating in both directions along the wire, causing the wire to lay mostly flat against the deck. <img src="images/clipboard-3079080065.png" class="img-fluid"> The wire dynamics model said that what should happen next is that the wire rebounds off the deck. But what actually happened is that the wire stayed down and the hook skips over the wire. <img src="images/clipboard-1366193013.png" class="img-fluid"> What isn’t shown is how FAST the hook would rebound into the jet. The readings were so high that the test team believed the accelerometer measuring hook up-swing was broken, but it wasn’t.</p>
<p>We tried, and tried, and tried over and over again to get the hook to work. While we were at Lakehurst, the program had a few days where we were forbidden from flying due to an IPP issue, but we kept trying roll-in arrestments at slower and slower speeds. None were successful. The hook kept rebounding at very high angular accelerations, damaging our very fragile tailhook instrumentation.</p>
<p>Many of my memories of August 2011 are of sitting on the concrete floor of a clamshell near the old F-8/F-14 engineering building, cleaning up damaged wiring and tediously calibrating rotational position sensors on the tailhook. All usually done late at night.</p>
<p>Hurricane Irene came through late in the month and made a direct line for us at Lakehurst. I came in to work one morning only to turn around and go back to my hotel and leave for home; the jet was sent back to PAX, ending our frustrating trials.</p>
<p>It was clear that the hook needed a redesign. The new hook has much stronger hold down damper, an all new damper for the upstroke, a better lateral limiter, and improved instrumentation that didn’t break on every arrestment. Here’s the new hook:</p>
<p><img src="images/clipboard-1416251102.png" class="img-fluid"></p>
<p>We also got an all new hook shoe! This one looks much more like a scoop, to catch the wire even if it’s down low on the deck. The new hook profile in red, old in blue, the arresting cable shown in purple:</p>
<p><img src="images/clipboard-1418549673.png" class="img-fluid"></p>
<p>Now, program note: for personal circumstances, I left the F-35 program entirely in mid 2012 only to return a little less than two years later to the same job. So I wasn’t there to see this in 2013:</p>
<p><img src="images/clipboard-3587626872.png" class="img-fluid"></p>
<p>The story most definitely does NOT end here though, because we had much struggle to go. We kept having issues with the bearing that the pitch pivot pin sits within. The pin is supposed to last at least 25 arrestments, but we were getting 1-2 before the pin sleeve would gall (Galling is wear that happens when metals slide past each other. Some material gets transferred from one metal surface to the other via frictional forces). We had a position sensor in that pin/sleeve to directly tell the control room the hook angular position during test, and all this pivot pin replacement meant I and a few other engineers spent a LOT of time working on CF-03’s tailhook.</p>
<p>During my years on the F-35 flight test program, I usually worked night shift engineering. Night shift had next to no meetings, it was pure flight support, problem solving, and performing instrumentation preflights for the next day’s test. Me and another engineer almost always worked together on the mission systems jets. CF-03 and its tailhook (as well as its launch bar and gear) instrumentation needed so much care and feeding that one of us would work just on CF-03. The other would take both BF-04 and BF-05.</p>
<p>We worked out some tricks for being able to replace a pitch pivot pin without having to re-perform a synchro (rotational position sensor) calibration. Why? Because new calibrations mean new instrumentation projects, which took several days and required a display check. Engineers, saving your program time and money out of the sheer laziness of not wanting to make a new XML format for an instrumentation project. This is how progress is made in the world, I guess. Most of 2015 saw me paying more attention to instrumentation project efficiency (something that, I am pleasantly surprised to see, gets a 1 paragraph mention in “From Concept to Cockpit”) but in 2016 I returned to Lakehurst with CF-03 to perform the trickiest tailhook tests.</p>
<p>We were doing tests with full external weapons (modulo not having AIM-9X on the outer wing stations…the wing structure needed a fix) and trying for off-center arrestments.</p>
<p>One cloudy day in May 2016 we try for an arrestment as far off centerline as we can go.</p>
<p>Here’s the story of that day.</p>
<p>I am sitting in something called the MITS (Mobile Instrumentation/Telemetry System). It’s literally a giant 18 wheeler trailer the Navy made that’s a mini control room. I am watching my instrumentation health screen and listening to the test audio, while watching the video on a television in the trailer.</p>
<p>An F-35C coming in for landing is usually at about 11 to 13 degrees nose high so that when it hits the carrier deck, it looks something like this:</p>
<p><img src="images/clipboard-2481399230.png" class="img-fluid"></p>
<p>Everything seems normal at first. I hear our pilot call the ball. But then I see on the screen that he’s actually coming in almost flat, and sinking like a stone. I expect to hear “WAVE OFF” from the fellow pilot monitoring him on the ground, acting as the Landing Signal Officer. I don’t hear that. And horrified, I watch on the video screen as the F-35 hits the ground with all three tires at once, then bounces off the runway, hits the runway again. The control room is full of engineers muttering curses under their breaths and staring at their screens.</p>
<p>Through the hotmic channel we have recording everything our pilot says and hears, I hear him yell “FUCK!” but he keeps control somehow and gets back in the air. “Lightning seven three is airborne, going back around” he says on the radio. Someone in the control room says that we have violated a flight test continuation criterion: we hit so hard that all the landing gear bottomed out. The lead test engineer gets on the radio and says “We need a gentle flared landing.” The pilot replies, “My body needs a gentle flared landing.”</p>
<p>Fortunately, once we come back around for a conventional landing, there is no further difficulty. But now, the post-flight debrief we have to talk about what happened and decide what to do next.</p>
<p>An immediate review of the data shows that the landing was at such a high sink rate that it is as if we have taken the F-35C and dropped it from a height of 20 feet. We hit almost entirely flat, just 2 degrees angle of attack.</p>
<p>It turns out that somehow the fresnel lens optical landing system (FLOLS) we are using was not set properly. Thus when the pilot thought he was flying on glideslope, he was flying a much too steep path. The LSO did not realize what was happening until it was too late.</p>
<p>Much consultation has to be done with the leaders of the program at Fort Worth. The day is late, the jet is impounded by the crew chief and no one is to work on it until formal inspection criteria are created. They arrive the next morning in my email, 200+ steps that I must conduct just on my flight test instrumentation hardware. Other maintainers and engineers have their own thick inspection stacks. It takes three days. We discover that we need new landing gear, but that can’t happen at Lakehurst. Fortunately it looks like the gear is good enough to support one more takeoff/landing cycle, so back to PAX it goes. The program decides to officially stop trying to chase the off-center arrrestments and wire only arrestments.</p>
<p>Thus ends the tailhook test saga.</p>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>